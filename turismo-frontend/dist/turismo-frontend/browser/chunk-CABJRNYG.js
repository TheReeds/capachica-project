import{Gb as m,Hc as C,Ib as y,La as o,Va as b,_a as u,fa as h,fb as l,ia as f,ob as n,pa as g,pb as r,qb as d,vb as p,wc as k}from"./chunk-ETYZCZA5.js";function w(a,t){a&1&&(n(0,"div",5)(1,"div",6),d(2,"div",7),n(3,"p",8),m(4,"Cargando mapa..."),r()()())}function x(a,t){if(a&1&&(n(0,"div",9),m(1),r()),a&2){let e=p();o(),y(" Radio: ",e.radiusKm,"km ")}}function L(a,t){a&1&&(n(0,"div",15)(1,"span",16),d(2,"span",17),m(3," \xC1rea de b\xFAsqueda "),r()())}function I(a,t){if(a&1&&(n(0,"div",10)(1,"div",11),f(),n(2,"svg",12),d(3,"path",13),r(),m(4," Haz clic en el mapa para seleccionar la ubicaci\xF3n exacta. "),r(),u(5,L,4,0,"div",14),r()),a&2){let e=p();o(5),l("ngIf",e.showRadiusIndicator)}}var v=class a{latitud;longitud;readOnly=!1;radiusKm=10;showRadiusIndicator=!1;zoom=13;ubicacionChange=new g;map;marker;radiusCircle;Leaflet;mapReady=!1;constructor(){}ngOnInit(){this.loadLeaflet().then(()=>{this.initMap()})}ngOnChanges(t){this.map&&this.Leaflet&&((t.latitud||t.longitud)&&this.updateMarkerPosition(),t.radiusKm&&this.showRadiusIndicator&&this.updateRadiusCircle())}ngAfterViewInit(){this.Leaflet&&!this.map&&setTimeout(()=>this.initMap(),100)}loadLeaflet(){return new Promise(t=>{if(window.L){this.Leaflet=window.L,t();return}let e=document.createElement("link");e.rel="stylesheet",e.href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css",e.integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=",e.crossOrigin="",document.head.appendChild(e);let i=document.createElement("script");i.src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js",i.integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=",i.crossOrigin="",i.onload=()=>{this.Leaflet=window.L,t()},document.head.appendChild(i)})}initMap(){if(!this.Leaflet)return;let t=this.latitud||-15.6428,e=this.longitud||-69.8334;try{this.map=this.Leaflet.map("map",{zoomControl:!0,scrollWheelZoom:!0,doubleClickZoom:!0,boxZoom:!0,keyboard:!0,dragging:!0,touchZoom:!0}).setView([t,e],this.zoom),this.Leaflet.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',maxZoom:19}).addTo(this.map),this.updateMarkerPosition(),this.showRadiusIndicator&&this.updateRadiusCircle(),this.readOnly||this.map.on("click",i=>{let c=i.latlng.lat,s=i.latlng.lng;this.ubicacionChange.emit({lat:c,lng:s}),this.updateMarker(c,s),this.showRadiusIndicator&&this.updateRadiusCircle()}),this.mapReady=!0}catch(i){console.error("Error inicializando el mapa:",i)}}updateMarkerPosition(){if(!(!this.map||!this.Leaflet)){if(!this.latitud||!this.longitud){this.marker&&(this.map.removeLayer(this.marker),this.marker=null);return}this.updateMarker(this.latitud,this.longitud),(this.readOnly||!this.marker)&&this.map.setView([this.latitud,this.longitud],this.zoom)}}updateMarker(t,e){if(!this.map||!this.Leaflet)return;this.marker?this.marker.setLatLng([t,e]):(this.marker=this.Leaflet.marker([t,e],{draggable:!this.readOnly}).addTo(this.map),this.readOnly||this.marker.on("dragend",c=>{let s=c.target.getLatLng();this.ubicacionChange.emit({lat:s.lat,lng:s.lng}),this.showRadiusIndicator&&this.updateRadiusCircle()}));let i="Ubicaci\xF3n seleccionada";this.readOnly&&(i="Ubicaci\xF3n del servicio"),this.marker.bindPopup(i)}updateRadiusCircle(){if(!this.map||!this.Leaflet||!this.marker)return;this.radiusCircle&&this.map.removeLayer(this.radiusCircle);let t=this.marker.getLatLng();this.radiusCircle=this.Leaflet.circle(t,{radius:this.radiusKm*1e3,fillColor:"#3b82f6",fillOpacity:.1,color:"#3b82f6",weight:2,opacity:.5}).addTo(this.map);let e=this.radiusCircle.getBounds();this.map.fitBounds(e,{padding:[20,20]})}updateRadius(t){this.radiusKm=t,this.showRadiusIndicator&&this.updateRadiusCircle()}clearMap(){this.marker&&(this.map.removeLayer(this.marker),this.marker=null),this.radiusCircle&&(this.map.removeLayer(this.radiusCircle),this.radiusCircle=null)}centerOnCapachica(){this.map&&this.map.setView([-15.6428,-69.8334],12)}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=b({type:a,selectors:[["app-ubicacion-map"]],inputs:{latitud:"latitud",longitud:"longitud",readOnly:"readOnly",radiusKm:"radiusKm",showRadiusIndicator:"showRadiusIndicator",zoom:"zoom"},outputs:{ubicacionChange:"ubicacionChange"},features:[h],decls:5,vars:3,consts:[[1,"relative","w-full","h-80","rounded-lg","overflow-hidden","border","border-gray-300","dark:border-gray-600","shadow-inner"],["id","map",1,"w-full","h-full"],["class","absolute inset-0 bg-gray-100 dark:bg-gray-800 flex items-center justify-center",4,"ngIf"],["class","absolute bottom-4 right-4 bg-black/70 text-white text-xs px-2 py-1 rounded",4,"ngIf"],["class","mt-2 text-sm text-gray-500 dark:text-gray-400",4,"ngIf"],[1,"absolute","inset-0","bg-gray-100","dark:bg-gray-800","flex","items-center","justify-center"],[1,"text-center"],[1,"inline-block","animate-spin","rounded-full","h-8","w-8","border-b-2","border-amber-600"],[1,"mt-2","text-sm","text-gray-600","dark:text-gray-400"],[1,"absolute","bottom-4","right-4","bg-black/70","text-white","text-xs","px-2","py-1","rounded"],[1,"mt-2","text-sm","text-gray-500","dark:text-gray-400"],[1,"flex","items-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","mr-1"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],["class","mt-1",4,"ngIf"],[1,"mt-1"],[1,"inline-flex","items-center"],[1,"w-2","h-2","bg-blue-500","rounded-full","mr-1","opacity-50"]],template:function(e,i){e&1&&(n(0,"div",0),d(1,"div",1),u(2,w,5,0,"div",2)(3,x,2,1,"div",3),r(),u(4,I,6,1,"div",4)),e&2&&(o(2),l("ngIf",!i.mapReady),o(),l("ngIf",!i.readOnly&&i.showRadiusIndicator),o(),l("ngIf",!i.readOnly))},dependencies:[C,k],styles:[".leaflet-container{height:100%;width:100%;font-family:inherit}  .leaflet-control-zoom a{background-color:#fff;color:#374151}  .leaflet-control-zoom a:hover{background-color:#f3f4f6}  .custom-radius-circle{fill:#3b82f61a;stroke:#3b82f680;stroke-width:2}"]})};export{v as a};
