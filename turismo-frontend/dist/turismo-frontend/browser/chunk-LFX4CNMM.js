import{A as i,Nc as p,Pc as d,R as t,Sc as m,U as l,_ as h,m as n,p as c,ua as s}from"./chunk-T2OCC6GX.js";var v=class a{http=h(d);API_URL=m.apiUrl;_carrito=s(null);_carritoItems=s([]);_isLoading=s(!1);_totalServicios=s(0);carrito=this._carrito.asReadonly();carritoItems=this._carritoItems.asReadonly();isLoading=this._isLoading.asReadonly();totalServicios=this._totalServicios.asReadonly();getHeaders(){let e=localStorage.getItem("auth_token");return new p({Authorization:`Bearer ${e}`,Accept:"application/json","Content-Type":"application/json"})}obtenerCarrito(){return this._isLoading.set(!0),this.http.get(`${this.API_URL}/reservas/carrito`,{headers:this.getHeaders()}).pipe(c(e=>e.data),t(e=>{this._carrito.set(e),this._carritoItems.set(e.servicios||[]),this._totalServicios.set(e.servicios?.length||0)}),i(e=>this.handleError(e)),t(()=>this._isLoading.set(!1)))}agregarAlCarrito(e){return this._isLoading.set(!0),this.http.post(`${this.API_URL}/reservas/carrito/agregar`,e,{headers:this.getHeaders()}).pipe(t(r=>{this.obtenerCarrito().subscribe()}),i(r=>this.handleError(r)),t(()=>this._isLoading.set(!1)))}eliminarDelCarrito(e){return this._isLoading.set(!0),this.http.delete(`${this.API_URL}/reservas/carrito/servicio/${e}`,{headers:this.getHeaders()}).pipe(t(r=>{let o=this._carritoItems().filter(g=>g.id!==e);this._carritoItems.set(o),this._totalServicios.set(o.length)}),i(r=>this.handleError(r)),t(()=>this._isLoading.set(!1)))}confirmarReserva(){return this._isLoading.set(!0),this.http.post(`${this.API_URL}/reservas/carrito/confirmar`,{},{headers:this.getHeaders()}).pipe(t(e=>{this.limpiarCarritoLocal()}),i(e=>this.handleError(e)),t(()=>this._isLoading.set(!1)))}vaciarCarrito(){return this._isLoading.set(!0),this.http.delete(`${this.API_URL}/reservas/carrito/vaciar`,{headers:this.getHeaders()}).pipe(t(e=>{this.limpiarCarritoLocal()}),i(e=>this.handleError(e)),t(()=>this._isLoading.set(!1)))}tieneItems(){return this._totalServicios()>0}getTotalItems(){return this._totalServicios()}limpiarCarritoLocal(){this._carrito.set(null),this._carritoItems.set([]),this._totalServicios.set(0)}inicializarCarrito(){localStorage.getItem("auth_token")&&this.obtenerCarrito().subscribe({next:()=>{console.log("Carrito inicializado correctamente")},error:r=>{console.log("No se pudo inicializar el carrito:",r)}})}limpiarCarritoAlCerrarSesion(){this.limpiarCarritoLocal()}handleError(e){console.error("Error en CarritoService:",e);let r="Ha ocurrido un error inesperado";return e.error?.message?r=e.error.message:e.message&&(r=e.message),e.status===401&&(r="Debe iniciar sesi\xF3n para acceder al carrito",this.limpiarCarritoLocal()),n(()=>({message:r,status:e.status}))}static \u0275fac=function(r){return new(r||a)};static \u0275prov=l({token:a,factory:a.\u0275fac,providedIn:"root"})};export{v as a};
