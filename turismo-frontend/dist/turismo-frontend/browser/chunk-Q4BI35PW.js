import{b as $,c as S,d as N,e as L,j,l as D,o as H,t as O,x as q,z}from"./chunk-KTW5JVGU.js";import{Ga as I,Gb as u,Hb as F,Hc as B,La as a,Qa as A,Qb as E,Va as G,_a as _,fb as p,ga as f,ha as g,ia as y,ja as b,jb as x,kb as P,mb as V,nb as T,ob as o,pa as w,pb as l,qb as h,tb as C,ub as c,uc as M,vb as m}from"./chunk-ETYZCZA5.js";import{a as k,b as U}from"./chunk-4CLCTAJ7.js";var X=s=>({"border-red-300 dark:border-red-700 focus:border-red-500 focus:ring-red-500":s});function Z(s,e){if(s&1&&h(0,"img",11),s&2){let t=m().$index,r=m();p("src",r.getPreviewUrl(t),I)}}function K(s,e){s&1&&(o(0,"div",12),y(),o(1,"svg",24),h(2,"path",25),l(),b(),o(3,"span"),u(4,"Selecciona una imagen"),l()())}function J(s,e){s&1&&(o(0,"p",20),u(1,"El nombre es obligatorio"),l())}function Q(s,e){if(s&1&&(o(0,"p",20),u(1),l()),s&2){let t=m().$index,r=m();a(),F(r.fileErrors[t])}}function W(s,e){s&1&&(o(0,"p",20),u(1,"El t\xEDtulo es obligatorio para sliders secundarios"),l())}function Y(s,e){if(s&1){let t=C();o(0,"div")(1,"label",17),u(2,"T\xEDtulo"),l(),o(3,"div",18)(4,"input",26),c("input",function(){f(t);let i=m(2);return g(i.onInputChange())}),l()(),_(5,W,2,0,"p",20),l(),o(6,"div")(7,"label",17),u(8,"Descripci\xF3n"),l(),o(9,"div",18)(10,"textarea",27),c("input",function(){f(t);let i=m(2);return g(i.onInputChange())}),l()()()}if(s&2){let t,r,i=m().$index,n=m();a(),p("for","slider-titulo-"+i),a(3),p("id","slider-titulo-"+i)("ngClass",E(6,X,!n.isSliderPrincipal&&((t=n.getSliderFormGroup(i).get("titulo"))==null?null:t.invalid)&&((t=n.getSliderFormGroup(i).get("titulo"))==null?null:t.touched))),a(),x(!n.isSliderPrincipal&&((r=n.getSliderFormGroup(i).get("titulo"))!=null&&r.invalid)&&((r=n.getSliderFormGroup(i).get("titulo"))!=null&&r.touched)?5:-1),a(2),p("for","slider-descripcion-"+i),a(3),p("id","slider-descripcion-"+i)}}function ee(s,e){if(s&1){let t=C();o(0,"div",7)(1,"div",9)(2,"div",10),_(3,Z,1,1,"img",11)(4,K,5,0,"div",12),o(5,"button",13),c("click",function(){let i=f(t).$index,n=m();return g(n.removeSlider(i))}),y(),o(6,"svg",14),h(7,"path",15),l()()(),b(),o(8,"div",16)(9,"div")(10,"label",17),u(11,"Nombre"),l(),o(12,"div",18)(13,"input",19),c("input",function(){f(t);let i=m();return g(i.onInputChange())}),l()(),_(14,J,2,0,"p",20),l(),h(15,"input",21),o(16,"div")(17,"label",17),u(18,"Orden"),l(),o(19,"div",18)(20,"input",22),c("input",function(){f(t);let i=m();return g(i.onInputChange())}),l()()(),o(21,"div")(22,"label",17),u(23,"Imagen (m\xE1x. 5MB)"),l(),o(24,"div",18)(25,"input",23),c("change",function(i){let n=f(t).$index,v=m();return g(v.onFileSelected(i,n))}),l()(),_(26,Q,2,1,"p",20),l(),_(27,Y,11,8),l()()()}if(s&2){let t,r,i=e.$index,n=m();a(),p("formGroup",n.getSliderFormGroup(i)),a(2),x(n.getPreviewUrl(i)?3:4),a(7),p("for","slider-nombre-"+i),a(3),p("id","slider-nombre-"+i)("ngClass",E(12,X,((t=n.getSliderFormGroup(i).get("nombre"))==null?null:t.invalid)&&((t=n.getSliderFormGroup(i).get("nombre"))==null?null:t.touched))),a(),x((r=n.getSliderFormGroup(i).get("nombre"))!=null&&r.invalid&&((r=n.getSliderFormGroup(i).get("nombre"))!=null&&r.touched)?14:-1),a(3),p("for","slider-orden-"+i),a(3),p("id","slider-orden-"+i),a(2),p("for","slider-imagen-"+i),a(3),p("id","slider-imagen-"+i),a(),x(n.fileErrors[i]?26:-1),a(),x(n.isSliderPrincipal?-1:27)}}function ie(s,e){if(s&1){let t=C();o(0,"div",8),y(),o(1,"svg",28),h(2,"path",25),l(),b(),o(3,"h3",29),u(4,"No hay im\xE1genes"),l(),o(5,"p",30),u(6,"A\xF1ade im\xE1genes para los sliders"),l(),o(7,"div",31)(8,"button",32),c("click",function(){f(t);let i=m();return g(i.addSlider())}),y(),o(9,"svg",33),h(10,"path",5),l(),u(11," A\xF1adir Imagen "),l()()()}}var R=class s{constructor(e){this.fb=e}title="Im\xE1genes de Slider";slidersFormArray;existingSliders=[];isSliderPrincipal=!0;changeSlidersEvent=new w;deletedSlidersEvent=new w;filePreviewUrls={};fileStore={};deletedSliderIds=[];fileErrors={};MAX_FILE_SIZE=12*1024*1024;ngOnInit(){for(;this.slidersFormArray.length!==0;)this.slidersFormArray.removeAt(0);this.filePreviewUrls={},this.fileStore={},this.deletedSliderIds=[],this.fileErrors={},this.existingSliders&&this.existingSliders.length>0&&(this.existingSliders.forEach((e,t)=>{let r=this.fb.group({id:[e.id],nombre:[e.nombre,S.required],es_principal:[this.isSliderPrincipal],orden:[e.orden,S.required],titulo:[e.titulo||"",this.isSliderPrincipal?[]:[S.required]],descripcion:[e.descripcion||""]});this.slidersFormArray.push(r),e.url_completa?this.filePreviewUrls[t]=e.url_completa:typeof e.imagen=="string"&&(this.filePreviewUrls[t]=e.imagen)}),this.emitSlidersChange())}get sliderControls(){return this.slidersFormArray.controls}getSliderFormGroup(e){return this.slidersFormArray.at(e)}createSliderFormGroup(){let e={id:[null],nombre:["",S.required],es_principal:[this.isSliderPrincipal],orden:[this.slidersFormArray.length+1,S.required]};return this.isSliderPrincipal?(e.titulo=[""],e.descripcion=[""]):(e.titulo=["",S.required],e.descripcion=[""]),this.fb.group(e)}addSlider(){let e=this.slidersFormArray.length;this.slidersFormArray.push(this.createSliderFormGroup()),this.filePreviewUrls[e]=null,this.fileStore[e]=null,console.log(`Added new slider at index ${e}, total: ${this.slidersFormArray.length}`),this.emitSlidersChange()}removeSlider(e){let t=this.getSliderFormGroup(e).get("id")?.value;t&&(this.deletedSliderIds.push(t),this.deletedSlidersEvent.emit(this.deletedSliderIds)),this.slidersFormArray.removeAt(e),delete this.filePreviewUrls[e],delete this.fileStore[e],delete this.fileErrors[e];let r={},i={},n={};Object.keys(this.filePreviewUrls).forEach(v=>{let d=parseInt(v);d>e?(r[d-1]=this.filePreviewUrls[d],i[d-1]=this.fileStore[d],this.fileErrors[d]&&(n[d-1]=this.fileErrors[d])):d<e&&(r[d]=this.filePreviewUrls[d],i[d]=this.fileStore[d],this.fileErrors[d]&&(n[d]=this.fileErrors[d]))}),this.filePreviewUrls=r,this.fileStore=i,this.fileErrors=n,this.emitSlidersChange()}onFileSelected(e,t){let r=e.target;if(r.files&&r.files.length){let i=r.files[0];if(i.size>this.MAX_FILE_SIZE){this.fileErrors[t]=`El archivo excede el tama\xF1o m\xE1ximo de 5MB (Tama\xF1o actual: ${(i.size/(1024*1024)).toFixed(2)}MB)`,r.value="";return}delete this.fileErrors[t],this.fileStore[t]=i;let n=new FileReader;n.onload=()=>{this.filePreviewUrls[t]=n.result,this.emitSlidersChange()},n.readAsDataURL(i)}}onInputChange(){this.emitSlidersChange()}getPreviewUrl(e){return this.filePreviewUrls[e]||null}emitSlidersChange(){if(this.slidersFormArray.length===0){this.changeSlidersEvent.emit([]);return}let e=this.slidersFormArray.controls.map((t,r)=>{let i=t,n=i.value,v=this.fileStore[r]||void 0,d=U(k({id:n.id,nombre:n.nombre||"",es_principal:this.isSliderPrincipal,orden:n.orden||r+1},v?{imagen:v}:{}),{url_completa:typeof this.filePreviewUrls[r]=="string"?this.filePreviewUrls[r]:void 0});return this.isSliderPrincipal||(d.titulo=i.get("titulo")?.value||"",d.descripcion=i.get("descripcion")?.value||""),d});this.changeSlidersEvent.emit(e)}hasFileErrors(){return Object.keys(this.fileErrors).length>0}areAllSlidersValid(){if(this.hasFileErrors())return!1;for(let e=0;e<this.slidersFormArray.length;e++)if(this.getSliderFormGroup(e).invalid)return!1;return!0}static \u0275fac=function(t){return new(t||s)(A(q))};static \u0275cmp=G({type:s,selectors:[["app-slider-upload"]],inputs:{title:"title",slidersFormArray:"slidersFormArray",existingSliders:"existingSliders",isSliderPrincipal:"isSliderPrincipal"},outputs:{changeSlidersEvent:"changeSlidersEvent",deletedSlidersEvent:"deletedSlidersEvent"},decls:12,vars:2,consts:[[1,"space-y-4"],[1,"flex","justify-between","items-center"],[1,"text-lg","font-medium","text-gray-900","dark:text-gray-100","transition-colors","duration-200"],["type","button",1,"inline-flex","items-center","rounded-md","bg-primary-600","px-3","py-1.5","text-sm","font-medium","text-white","hover:bg-primary-700","focus:outline-none","focus:ring-2","focus:ring-primary-500","focus:ring-offset-2","transition-colors","duration-200",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"-ml-0.5","mr-1.5","h-4","w-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],[1,"grid","grid-cols-1","gap-4","sm:grid-cols-2","lg:grid-cols-3"],[1,"rounded-lg","border","border-gray-200","dark:border-gray-700","bg-white","dark:bg-gray-800","shadow-sm","overflow-hidden","transition-colors","duration-200"],[1,"col-span-full","p-6","text-center","border-2","border-dashed","border-gray-300","dark:border-gray-700","rounded-lg","transition-colors","duration-200"],[3,"formGroup"],[1,"relative","aspect-video","bg-gray-100","dark:bg-gray-700","flex","items-center","justify-center","overflow-hidden","transition-colors","duration-200"],["alt","Vista previa de slider",1,"h-full","w-full","object-cover",3,"src"],[1,"text-gray-400","dark:text-gray-500","flex","flex-col","items-center","justify-center","p-4","text-center","transition-colors","duration-200"],["type","button","title","Eliminar slider",1,"absolute","top-2","right-2","bg-red-100","dark:bg-red-900/30","text-red-600","dark:text-red-400","p-1","rounded-full","hover:bg-red-200","dark:hover:bg-red-800/30","focus:outline-none","focus:ring-2","focus:ring-red-500","transition-colors","duration-200",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"h-4","w-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"p-4","space-y-3"],[1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300","transition-colors","duration-200",3,"for"],[1,"mt-2"],["type","text","formControlName","nombre",1,"block","w-full","h-10","px-3","rounded-md","border-gray-300","dark:border-gray-700","dark:bg-gray-900","dark:text-white","shadow-sm","focus:border-primary-500","focus:ring-primary-500","sm:text-sm","transition-colors","duration-200",3,"input","id","ngClass"],[1,"mt-1","text-sm","text-red-600","dark:text-red-400","transition-colors","duration-200"],["type","hidden","formControlName","es_principal"],["type","number","formControlName","orden","min","1",1,"block","w-full","h-10","px-3","rounded-md","border-gray-300","dark:border-gray-700","dark:bg-gray-900","dark:text-white","shadow-sm","focus:border-primary-500","focus:ring-primary-500","sm:text-sm","transition-colors","duration-200",3,"input","id"],["type","file","accept","image/*",1,"block","w-full","text-sm","text-gray-500","dark:text-gray-400","file:mr-4","file:py-2","file:px-4","file:rounded-md","file:border-0","file:text-sm","file:font-medium","file:bg-primary-50","dark:file:bg-primary-900/20","file:text-primary-700","dark:file:text-primary-400","hover:file:bg-primary-100","dark:hover:file:bg-primary-800/30","transition-colors","duration-200",3,"change","id"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"h-10","w-10","mb-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"],["type","text","formControlName","titulo",1,"block","w-full","h-10","px-3","rounded-md","border-gray-300","dark:border-gray-700","dark:bg-gray-900","dark:text-white","shadow-sm","focus:border-primary-500","focus:ring-primary-500","sm:text-sm","transition-colors","duration-200",3,"input","id","ngClass"],["formControlName","descripcion","rows","3",1,"block","w-full","px-3","py-2","rounded-md","border-gray-300","dark:border-gray-700","dark:bg-gray-900","dark:text-white","shadow-sm","focus:border-primary-500","focus:ring-primary-500","sm:text-sm","transition-colors","duration-200",3,"input","id"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"mx-auto","h-12","w-12","text-gray-400","dark:text-gray-500","transition-colors","duration-200"],[1,"mt-2","text-sm","font-medium","text-gray-900","dark:text-gray-100","transition-colors","duration-200"],[1,"mt-1","text-sm","text-gray-500","dark:text-gray-400","transition-colors","duration-200"],[1,"mt-6"],["type","button",1,"inline-flex","items-center","rounded-md","bg-primary-600","px-4","py-2","text-sm","font-medium","text-white","hover:bg-primary-700","focus:outline-none","focus:ring-2","focus:ring-primary-500","focus:ring-offset-2","transition-colors","duration-200",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"-ml-1","mr-2","h-5","w-5"]],template:function(t,r){t&1&&(o(0,"div",0)(1,"div",1)(2,"h3",2),u(3),l(),o(4,"button",3),c("click",function(){return r.addSlider()}),y(),o(5,"svg",4),h(6,"path",5),l(),u(7," A\xF1adir Imagen "),l()(),b(),o(8,"div",6),V(9,ee,28,14,"div",7,P),_(11,ie,12,0,"div",8),l()()),t&2&&(a(3),F(r.title),a(6),T(r.sliderControls),a(2),x(r.sliderControls.length===0?11:-1))},dependencies:[B,M,z,$,j,N,L,O,D,H],encapsulation:2})};export{R as a};
